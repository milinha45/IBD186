CREATE SCHEMA ESTOQUE;

USE ESTOQUE;

CREATE TABLE EST_ESTADO (
  EST_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  EST_NOME VARCHAR(20) NOT NULL,
  EST_SIGLA VARCHAR(2) NOT NULL,
  CONSTRAINT EST_ESTADO_PK PRIMARY KEY (EST_ID),
  CONSTRAINT EST_SIGLA_UK UNIQUE KEY (EST_SIGLA)
);

CREATE TABLE EMP_EMPRESA (
  EMP_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  EMP_NOME VARCHAR(50) NOT NULL,
  EMP_CNPJ VARCHAR(16) NOT NULL,
  EST_ID BIGINT UNSIGNED NOT NULL,
  CONSTRAINT EMP_EMPRESA_PK PRIMARY KEY (EMP_ID),
  CONSTRAINT EMP_CNPJ_UK UNIQUE KEY (EMP_CNPJ),
  FOREIGN KEY EST_ID_FK (EST_ID) REFERENCES EST_ESTADO (EST_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);


CREATE TABLE USR_USUARIO (
  USR_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  USR_NOME VARCHAR(20) NOT NULL,
  USR_SENHA VARCHAR(50) NOT NULL,
  EMP_ID BIGINT UNSIGNED NOT NULL,
  CONSTRAINT USR_USUARIO_PK PRIMARY KEY (USR_ID),
  CONSTRAINT USR_NOME_UK UNIQUE KEY (USR_NOME),
  FOREIGN KEY EMP_ID_FK (EMP_ID) REFERENCES EMP_EMPRESA (EMP_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE AUT_AUTORIZACAO (
  AUT_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  AUT_NOME VARCHAR(20) NOT NULL,
  CONSTRAINT AUT_AUTORIZACAO_PK PRIMARY KEY (AUT_ID),
  CONSTRAINT AUT_NOME_UK UNIQUE KEY (AUT_NOME)
);

CREATE TABLE UAU_USUARIO_AUTORIZACAO (
  USR_ID BIGINT UNSIGNED NOT NULL,
  AUT_ID BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (USR_ID, AUT_ID),
  FOREIGN KEY UAU_USUARIO_FK (USR_ID) REFERENCES USR_USUARIO (USR_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
  FOREIGN KEY UAU_AUTORIZACAO_FK (AUT_ID) REFERENCES AUT_AUTORIZACAO (AUT_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);

DROP SCHEMA ESTOQUE;